!function(){"use strict";function t(t,e){console.time(t);const n=e();return console.timeEnd(t),n}function*e(t){let e=0;for(const n of t)yield[e,n],e++}class n{constructor(){this.trie={}}get(t){let e=this.trie;for(const n of t)if(e=e[n],void 0===e)return null;return e.$||null}set(t,n){let r=this.trie;const o=t.length-1;for(const[s,u]of e(t))r[u]?s===o&&r[u].$?r[u].$.push(n(t,u,s)):s===o&&(r[u].$=[n(t,u,s)]):r[u]=s===o?{$:[n(t,u,s)]}:{},r=r[u];return this}has(t){return!!this.get(t)}words(){const t=function*(e,n){for(const r of Object.keys(e))"$"===r?yield n.join(""):yield*t(e[r],[...n,r])};return t(this.trie,[])}}const r={letter:/[a-zA-Z]/i,number:/\d/i,space:/\s/i,punct:/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]/i};function o(t){return r.letter.test(t)}function s(t){return r.space.test(t)}function u(t){return r.punct.test(t)}function i(t){return r.number.test(t)}class c{constructor(t){this.input=t,this.pos=0}next(){return this.input.charAt(this.pos++)}peek(){return this.input.charAt(this.pos)}eof(){return""===this.peek()}err(t){throw new Error(`${t} @ ${this.pos}`)}}class l{constructor(t){this.current=null,this.input=t}readWhile(t){let e="";for(;!this.input.eof()&&t(this.input.peek());)e+=this.input.next();return e}readNum(){let t=!1,e=this.readWhile((e=>"."===e?!t&&(t=!0,!0):i(e)));return{type:"number",value:parseFloat(e)}}readWord(){return{type:"word",value:this.readWhile(o)}}readSpace(){return{type:"space",value:this.readWhile(s)}}readPunct(){return{type:"punctuation",value:this.readWhile(u)}}readUnknown(){return{type:"unknown",value:this.input.next()}}peek(){return this.current||(this.current=this.readNext())}next(){let t=this.current;return this.current=null,t||this.readNext()}eof(){return null===this.peek()}readNext(){if(this.input.eof())return null;{const t=this.input.peek();return o(t)?this.readWord():i(t)?this.readNum():s(t)?this.readSpace():u(t)?this.readPunct():this.readUnknown()}}}function a(t){let e=new Map;for(const{value:n}of t)e.has(n)?e.set(n,e.get(n)+1):e.set(n,1);const n=e.size;let r=[];for(const[t,o]of e)r.push({term:t,count:o,termFrequency:o/n});return r}function d(t,e){return t.getElementsByClassName(e)}function f([t]){return t}function h(t,e){return t.appendChild(e),t}function p(t){return document.createElement(t)}function m({score:t,elem:e}){const n=`${(100*t).toFixed(2)}%`,r=h(p("div"),(o=p("h3"),void 0===(s=`Relevance: ${n}`)?o.textContent:(o.textContent=s,o)));var o,s;return h(r,e)}let y=null;function b(t){return function(t){const e=new l(new c(t));let n=[];for(;!e.eof();)n.push(e.next());return n}(t).filter((({type:t})=>"word"===t))}let x=[];!function(t,e){const n=f(d(document,"comment-tree")),r=Array.from(d(n,"athing")).map(((t,e)=>function(t,e,n){const r=e.querySelector(".commtext").textContent.toLowerCase();return{_id:n,elem:e,text:r,score:0}}(0,t,e)));r.forEach((({text:t},n)=>e.push(t))),y=function(t){let e=[...t],n={filter(r){const o=r.reduce(((t,{_id:e,...n})=>(t[e]=n,t)),{});return e=t.filter((({_id:t})=>!!o[t])).map((t=>({...t,score:o[t._id].tf_idf}))).sort(((t,e)=>e.score-t.score)),n},reset:()=>(e=[...t],n),appendElements(){const t=f(d(document,"comment-tree")),n=function(t,e){for(const n of e)h(t,n);return t}(p("table"),e.map(m));return h(((r=t).innerHTML="",r),n);var r}};return n}(r)}(0,x);let v=null;t("[init engine]",(()=>v=function(r){const o=r.length,s=t("[tokenize]",(()=>r.map(b)));let u=new n;return t("[build trie]",(()=>{for(const[t,n]of e(s))for(const e of a(n)){const{term:n,termFrequency:r}=e;u.set(n,(()=>({_id:t,termFrequency:r})))}})),{totalDocs:o,trie:u,search(t){return t.split(" ").reduce(((t,e)=>(t.push(...this.tf_idf(e)),t)),[]).sort(((t,e)=>e.tf_idf-t.tf_idf))},tf_idf(t){const e=u.get(t)||[],n=e.length,r=Math.log(o/n);let s=[];for(let t=0;t<n;t++){const{_id:n,termFrequency:o}=e[t];s.push({_id:n,tf:o,idf:r,tf_idf:o*r})}return s}}}(x)));let g=function(){let t=new Map,e={subscribe:(n,r)=>(t.set(n,r),e),unsubscribe:n=>(t.delete(n),e),notify(n){for(const[e,r]of t)r(n);return e}};return e}();let w=document.querySelector(".fatitem tbody");w.appendChild(function(){const e=document.createElement("tr");return e.innerHTML='\n\t\t<td colspan="2"></td>\n\t\t<td>\n\t\t\t<label>Search Job Postings</label>\n\t\t\t<input type="text" id="job-search-bar" />\n\t\t</td>\n\t',e.querySelector("#job-search-bar").onchange=function(e){const n=t("[search]",(()=>v.search(this.value)));g.notify(n)},e}()),w.appendChild(function(){const t=document.createElement("tr");t.innerHTML='\n\t\t<td colspan="2"></td>\n\t\t<td><div id="job-search-results"></div></td>\n\t';const e=t.querySelector("#job-search-results");return g.subscribe("SearchResults",(t=>{const n=t.length;e.textContent=`${n} documents found.`,0===n?y.reset().appendElements():y.filter(t).appendElements()})),t}())}();
